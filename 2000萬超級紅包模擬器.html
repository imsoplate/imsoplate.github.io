<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ğŸ§§ 2,000è¬è¶…ç´šç´…åŒ…æ¨¡æ“¬å™¨</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- Confetti Library -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    
    <style>
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #7f1d1d; /* Deep Red */
            background-image: linear-gradient(135deg, #7f1d1d 0%, #991b1b 100%);
        }
        .glass-panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
        }
        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1; 
        }
        ::-webkit-scrollbar-thumb {
            background: #c53030; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #9b2c2c; 
        }
        .animate-bounce-slow {
            animation: bounce 2s infinite;
        }
        
        button {
            touch-action: manipulation;
        }
    </style>
</head>
<body class="min-h-screen p-3 md:p-8 flex items-center justify-center">

    <div class="glass-panel w-full max-w-2xl rounded-2xl shadow-2xl overflow-hidden relative border-4 border-yellow-500 mb-8">
        
        <!-- Header -->
        <div class="bg-red-700 p-6 text-center relative overflow-hidden">
            <div class="absolute top-0 left-0 w-full h-full opacity-10 pointer-events-none">
                <svg width="100%" height="100%">
                    <pattern id="pattern-circles" x="0" y="0" width="20" height="20" patternUnits="userSpaceOnUse">
                        <circle cx="10" cy="10" r="2" fill="#fbbf24"></circle>
                    </pattern>
                    <rect x="0" y="0" width="100%" height="100%" fill="url(#pattern-circles)"></rect>
                </svg>
            </div>
            <h1 class="text-3xl md:text-4xl font-bold text-yellow-400 mb-2 drop-shadow-md">ğŸ§§ 2,000è¬è¶…ç´šç´…åŒ…</h1>
            <p class="text-red-100 text-sm md:text-base opacity-90">ä¸€å¼µå”®åƒ¹ $2,000 | ç¸½ä¸­çç‡ 69.33%</p>
        </div>

        <!-- Lifetime Stats Panel (ä¿ç•™é€™å€‹æœ¬åœ°çµ±è¨ˆåŠŸèƒ½) -->
        <div class="bg-orange-50 border-b border-orange-200 p-4 shadow-inner">
            <h3 class="text-orange-800 font-bold text-center text-xs mb-3 flex justify-center items-center gap-1 opacity-70">
                <span>ğŸ“Š</span> æœ¬æ¬¡ä¸Šç·šç´¯ç©æˆ°ç¸¾
            </h3>
            <div class="flex justify-around items-center text-center">
                <div>
                    <div class="text-xs text-orange-600 font-bold uppercase tracking-wide mb-1">ç´¯ç©æŠ•å…¥</div>
                    <div id="lifeCost" class="text-lg md:text-xl font-bold text-gray-700 font-mono">$0</div>
                </div>
                <div class="w-px h-8 bg-orange-200"></div>
                <div>
                    <div class="text-xs text-orange-600 font-bold uppercase tracking-wide mb-1">ç´¯ç©å›æ”¶</div>
                    <div id="lifeWin" class="text-lg md:text-xl font-bold text-green-600 font-mono">$0</div>
                </div>
                <div class="w-px h-8 bg-orange-200"></div>
                <div>
                    <div class="text-xs text-orange-600 font-bold uppercase tracking-wide mb-1">ç´¯ç©æç›Š</div>
                    <div id="lifeNet" class="text-lg md:text-xl font-bold text-gray-400 font-mono">$0</div>
                </div>
            </div>
        </div>

        <div class="p-4 md:p-8">
            <!-- Inputs -->
            <div class="bg-red-50 rounded-xl p-4 md:p-6 mb-6 border border-red-100">
                <div class="flex flex-col md:flex-row items-center justify-center gap-4 md:gap-8">
                    
                    <div class="w-full md:w-auto">
                        <label class="block text-red-800 text-sm font-bold mb-2">è³¼è²·å¼µæ•¸</label>
                        <div class="relative">
                            <input type="number" id="ticketCount" min="1" value="1" 
                                class="w-full md:w-40 pl-4 pr-4 py-3 border-2 border-red-200 rounded-lg focus:outline-none focus:border-red-500 text-center text-xl font-bold text-gray-700 shadow-sm transition-colors"
                                placeholder="å¼µæ•¸">
                        </div>
                    </div>

                    <div class="hidden md:block text-red-300 text-2xl pt-6">â‡„</div>

                    <div class="w-full md:w-auto">
                        <label class="block text-red-800 text-sm font-bold mb-2">ç¸½èŠ±è²»é‡‘é¡ ($)</label>
                        <div class="relative">
                            <input type="number" id="totalCostInput" min="2000" value="2000" 
                                class="w-full md:w-48 pl-4 pr-4 py-3 border-2 border-red-200 rounded-lg focus:outline-none focus:border-red-500 text-center text-xl font-bold text-gray-700 shadow-sm transition-colors"
                                placeholder="é‡‘é¡">
                        </div>
                    </div>
                </div>
                
                <div id="errorMsg" class="text-red-600 font-bold text-center mt-3 h-5 text-sm"></div>
            </div>

            <!-- Action Buttons -->
            <div class="flex flex-col gap-4">
                <button id="scratchBtn" onclick="startSimulation()" 
                    class="w-full bg-gradient-to-r from-red-600 to-red-700 hover:from-red-500 hover:to-red-600 text-white font-bold py-4 px-8 rounded-full shadow-lg transform transition hover:-translate-y-1 active:translate-y-0 text-xl flex items-center justify-center gap-2 group border-b-4 border-red-900">
                    <span class="group-hover:animate-bounce-slow">ğŸ’°</span> ä¸€éµå…¨åˆ® <span class="group-hover:animate-bounce-slow">ğŸ’°</span>
                </button>
            </div>

            <!-- Loading State -->
            <div id="loading" class="hidden text-center py-8">
                <div class="inline-block animate-spin rounded-full h-8 w-8 border-4 border-red-600 border-t-transparent"></div>
                <p class="text-red-600 mt-2 font-medium">æ­£åœ¨åˆ®é–‹éŠ€æ¼†...</p>
            </div>

            <!-- Results Area -->
            <div id="resultBox" class="hidden mt-8 animate-fade-in">
                
                <!-- Scorecard -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-3 mb-6">
                    <div class="bg-gray-50 p-3 rounded-xl text-center border border-gray-200">
                        <div class="text-gray-500 text-sm mb-1">æœ¬è¼ªèŠ±è²»</div>
                        <div id="totalCostDisplay" class="text-lg font-bold text-gray-800">$0</div>
                    </div>
                    <div class="bg-gray-50 p-3 rounded-xl text-center border border-gray-200">
                        <div class="text-gray-500 text-sm mb-1">æœ¬è¼ªä¸­ç</div>
                        <div id="totalWinDisplay" class="text-lg font-bold text-green-600">$0</div>
                    </div>
                    <div class="bg-gray-50 p-3 rounded-xl text-center border border-gray-200 relative overflow-hidden">
                        <div class="text-gray-500 text-sm mb-1">æœ¬è¼ªæç›Š</div>
                        <div id="netProfitDisplay" class="text-xl font-black">$0</div>
                        <div id="resultBadge" class="hidden absolute top-0 right-0 bg-yellow-400 text-xs font-bold px-2 py-1 rounded-bl-lg text-red-900 shadow-sm">WIN!</div>
                    </div>
                </div>

                <hr class="border-gray-200 my-6">

                <!-- Detail Table -->
                <h3 class="text-gray-700 font-bold mb-3 flex items-center gap-2">
                    <svg class="w-5 h-5 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"></path></svg>
                    æœ¬è¼ªä¸­çæ˜ç´°
                </h3>
                <div class="overflow-x-auto rounded-lg border border-gray-200">
                    <table class="w-full text-sm text-left">
                        <thead class="text-xs text-gray-700 uppercase bg-gray-100">
                            <tr>
                                <th class="px-4 py-3">çé …</th>
                                <th class="px-4 py-3 text-center">æ•¸é‡</th>
                                <th class="px-4 py-3 text-right">å°è¨ˆ</th>
                            </tr>
                        </thead>
                        <tbody id="detailsBody" class="bg-white divide-y divide-gray-200">
                            <!-- JS Generated -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Probability Toggle -->
            <div class="mt-8 pt-6 border-t border-gray-100">
                <button onclick="toggleProbTable()" class="flex items-center justify-between w-full text-left text-gray-500 hover:text-red-600 transition-colors py-2">
                    <span class="font-medium flex items-center gap-2">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                        æŸ¥çœ‹å®˜æ–¹çé …çµæ§‹èˆ‡æ©Ÿç‡
                    </span>
                    <span id="arrowIcon">â–¼</span>
                </button>
                
                <div id="probSection" class="hidden mt-4 animate-fade-in-down">
                    <div class="overflow-x-auto rounded-lg border border-gray-200">
                        <table class="w-full text-sm">
                            <thead class="text-xs text-gray-500 uppercase bg-gray-50">
                                <tr>
                                    <th class="px-3 py-2 text-left">çé …</th>
                                    <th class="px-3 py-2 text-right">ç¸½å¼µæ•¸</th>
                                    <th class="px-3 py-2 text-right">ä¸­çç‡</th>
                                    <th class="px-3 py-2 text-right">å¤§ç´„æ©Ÿç‡</th>
                                </tr>
                            </thead>
                            <tbody id="probBody" class="divide-y divide-gray-100 bg-white text-gray-600">
                                <!-- JS Generated -->
                            </tbody>
                        </table>
                    </div>
                    <div class="mt-2 text-xs text-gray-400 text-right">
                        * åŸºæ–¼ç™¼è¡Œç¸½å¼µæ•¸ 11,500,092 å¼µè¨ˆç®—
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <div class="fixed bottom-2 w-full text-center pointer-events-none">
        <p class="text-white/40 text-xs">åƒ…ä¾›å¨›æ¨‚ â€¢ è«‹å‹¿éåº¦æ²‰è¿·è³­åš</p>
    </div>

    <script>
        // --- æ•¸æ“šè¨­å®š (æ ¸å¿ƒé‚è¼¯ä¸è®Š) ---
        const TOTAL_TICKETS = 11500092;
        const TICKET_PRICE = 2000;

        const PRIZE_STRUCTURE = [
            { amount: 20000000, count: 10, name: "é ­ç 2000è¬" },
            { amount: 1000000, count: 1200, name: "äºŒç 100è¬" },
            { amount: 100000, count: 5474, name: "ä¸‰ç 10è¬" },
            { amount: 30000, count: 4830, name: "å››ç 3è¬" },
            { amount: 10000, count: 63710, name: "äº”ç 1è¬" },
            { amount: 5000, count: 1108370, name: "å…­ç 5åƒ" },
            { amount: 2000, count: 2189140, name: "ä¸ƒç 2åƒ" },
            { amount: 1000, count: 4600000, name: "å…«ç 1åƒ" },
            { amount: 0, count: 0, name: "æ²’ä¸­ç" } 
        ];

        // åˆå§‹åŒ–æ¬Šé‡
        let winningTicketsCount = 0;
        PRIZE_STRUCTURE.forEach(p => {
            if (p.amount > 0) winningTicketsCount += p.count;
        });
        PRIZE_STRUCTURE[PRIZE_STRUCTURE.length - 1].count = TOTAL_TICKETS - winningTicketsCount;

        let cumulativeCounts = [];
        let currentSum = 0;
        PRIZE_STRUCTURE.forEach(p => {
            currentSum += p.count;
            cumulativeCounts.push(currentSum);
        });

        // --- State Variables for Lifetime Stats ---
        let lifetimeCost = 0;
        let lifetimeWin = 0;

        // --- DOM Elements ---
        const ticketInput = document.getElementById('ticketCount');
        const costInput = document.getElementById('totalCostInput');
        const errorMsg = document.getElementById('errorMsg');
        const scratchBtn = document.getElementById('scratchBtn');
        const loadingDiv = document.getElementById('loading');
        const resultBox = document.getElementById('resultBox');

        // Lifetime DOM
        const lifeCostEl = document.getElementById('lifeCost');
        const lifeWinEl = document.getElementById('lifeWin');
        const lifeNetEl = document.getElementById('lifeNet');

        // --- åˆå§‹åŒ–é é¢ ---
        window.onload = function() {
            renderProbTable();
        };

        // --- æ©Ÿç‡è¡¨é¡¯ç¤ºåˆ‡æ› ---
        function toggleProbTable() {
            const section = document.getElementById('probSection');
            const arrow = document.getElementById('arrowIcon');
            if (section.classList.contains('hidden')) {
                section.classList.remove('hidden');
                arrow.textContent = 'â–²';
            } else {
                section.classList.add('hidden');
                arrow.textContent = 'â–¼';
            }
        }

        // --- æ¸²æŸ“æ©Ÿç‡è¡¨ ---
        function renderProbTable() {
            const tbody = document.getElementById('probBody');
            let html = "";
            
            PRIZE_STRUCTURE.forEach(p => {
                let percentage = (p.count / TOTAL_TICKETS * 100);
                let percentageStr = percentage < 0.01 ? percentage.toFixed(6) : percentage.toFixed(2);
                let oneInX = Math.round(TOTAL_TICKETS / p.count);
                let chanceStr = p.count > 0 ? `ç´„ ${oneInX.toLocaleString()} å¼µä¸­ 1` : "-";
                if (p.name === "æ²’ä¸­ç") chanceStr = `ç´„ 3 å¼µä¸­ 1`;

                let rowClass = p.amount >= 100000 ? "text-red-600 font-bold bg-red-50" : "";
                
                html += `<tr class="${rowClass}">
                    <td class="px-3 py-2 text-left whitespace-nowrap">${p.name}</td>
                    <td class="px-3 py-2 text-right text-gray-500">${p.count.toLocaleString()}</td>
                    <td class="px-3 py-2 text-right">${percentageStr}%</td>
                    <td class="px-3 py-2 text-right whitespace-nowrap text-xs">${chanceStr}</td>
                </tr>`;
            });
            tbody.innerHTML = html;
        }

        // --- è¼¸å…¥é€£å‹• ---
        ticketInput.addEventListener('input', function() {
            let count = parseInt(this.value);
            if (count && count > 0) {
                costInput.value = count * TICKET_PRICE;
                clearError();
            } else {
                costInput.value = "";
            }
        });

        costInput.addEventListener('input', function() {
            let cost = parseInt(this.value);
            if (!cost) {
                ticketInput.value = "";
                clearError();
                return;
            }
            if (cost % TICKET_PRICE === 0) {
                ticketInput.value = cost / TICKET_PRICE;
                clearError();
            } else {
                errorMsg.textContent = "âš  è«‹è¼¸å…¥ 2000 çš„å€æ•¸";
                ticketInput.value = "";
                scratchBtn.disabled = true;
                scratchBtn.classList.add('opacity-50', 'cursor-not-allowed');
            }
        });

        function clearError() {
            errorMsg.textContent = "";
            scratchBtn.disabled = false;
            scratchBtn.classList.remove('opacity-50', 'cursor-not-allowed');
        }

        // --- æ¨¡æ“¬é‚è¼¯ ---
        function startSimulation() {
            const numToBuy = parseInt(ticketInput.value);

            if (!numToBuy || numToBuy < 1) {
                errorMsg.textContent = "è«‹è¼¸å…¥æ­£ç¢ºçš„å¼µæ•¸ï¼";
                return;
            }
            if (numToBuy > 100000) {
                if(!confirm("æ•¸é‡éå¤§å¯èƒ½å°è‡´ç¶²é å¡é “ï¼Œç¢ºå®šè¦åˆ®é€™éº¼å¤šå¼µå—ï¼Ÿ")) return;
            }

            // UI State Change
            scratchBtn.classList.add('hidden');
            resultBox.classList.add('hidden');
            loadingDiv.classList.remove('hidden');

            // Simulate delay for effect (500ms)
            setTimeout(() => {
                runScratchLogic(numToBuy);
                loadingDiv.classList.add('hidden');
                scratchBtn.classList.remove('hidden');
                resultBox.classList.remove('hidden');
                
                // Scroll to result on mobile
                if (window.innerWidth < 768) {
                    resultBox.scrollIntoView({ behavior: 'smooth' });
                }
            }, 600);
        }

        function runScratchLogic(numToBuy) {
            let totalCost = numToBuy * TICKET_PRICE;
            let totalWin = 0;
            let results = new Array(PRIZE_STRUCTURE.length).fill(0);

            for (let i = 0; i < numToBuy; i++) {
                let rand = Math.floor(Math.random() * TOTAL_TICKETS) + 1;
                for (let j = 0; j < cumulativeCounts.length; j++) {
                    if (rand <= cumulativeCounts[j]) {
                        results[j]++;
                        totalWin += PRIZE_STRUCTURE[j].amount;
                        break;
                    }
                }
            }
            displayResults(totalCost, totalWin, results);
        }

        function displayResults(cost, win, counts) {
            const costDisplay = document.getElementById('totalCostDisplay');
            const winDisplay = document.getElementById('totalWinDisplay');
            const netProfitDisplay = document.getElementById('netProfitDisplay');
            const detailsBody = document.getElementById('detailsBody');
            const resultBadge = document.getElementById('resultBadge');
            
            const fmt = (num) => "$" + num.toLocaleString();

            let net = win - cost;
            costDisplay.textContent = fmt(cost);
            winDisplay.textContent = fmt(win);

            // Update Lifetime Stats
            lifetimeCost += cost;
            lifetimeWin += win;
            let lifeNet = lifetimeWin - lifetimeCost;

            lifeCostEl.textContent = fmt(lifetimeCost);
            lifeWinEl.textContent = fmt(lifetimeWin);
            
            if (lifeNet >= 0) {
                lifeNetEl.textContent = "+" + fmt(lifeNet);
                lifeNetEl.classList.remove('text-green-600', 'text-gray-400');
                lifeNetEl.classList.add('text-red-600');
            } else {
                lifeNetEl.textContent = "-" + fmt(Math.abs(lifeNet));
                lifeNetEl.classList.remove('text-red-600', 'text-gray-400');
                lifeNetEl.classList.add('text-green-600');
            }
            
            // Reset styles
            netProfitDisplay.classList.remove('text-green-600', 'text-red-600');
            resultBadge.classList.add('hidden');

            if (net > 0) {
                netProfitDisplay.textContent = "+" + fmt(net);
                netProfitDisplay.classList.add('text-red-600'); // Red is good/money in TW
                resultBadge.classList.remove('hidden');
                resultBadge.textContent = "è³ºçˆ›äº†!";
                triggerConfetti();
            } else if (net === 0) {
                netProfitDisplay.textContent = "å›æœ¬";
                netProfitDisplay.classList.add('text-yellow-600');
            } else {
                netProfitDisplay.textContent = "-" + fmt(Math.abs(net));
                netProfitDisplay.classList.add('text-green-700'); // Green is loss in stock/finance logic usually, or stick to Green/Red contrast
            }

            let html = "";
            let hasWin = false;
            for (let i = 0; i < PRIZE_STRUCTURE.length; i++) {
                if (counts[i] > 0) {
                    hasWin = true;
                    let subtotal = counts[i] * PRIZE_STRUCTURE[i].amount;
                    let isBigPrize = PRIZE_STRUCTURE[i].amount >= 100000;
                    let rowClass = isBigPrize ? "bg-red-50 font-bold text-red-700" : "";
                    
                    html += `<tr class="${rowClass}">
                        <td class="px-4 py-3 border-b">${PRIZE_STRUCTURE[i].name}</td>
                        <td class="px-4 py-3 border-b text-center">${counts[i]}</td>
                        <td class="px-4 py-3 border-b text-right font-medium text-gray-900">${fmt(subtotal)}</td>
                    </tr>`;
                }
            }
            if (!hasWin || (counts[counts.length-1] === parseInt(document.getElementById('ticketCount').value))) {
                 if (html === "") {
                     html = `<tr><td colspan='3' class="px-4 py-8 text-center text-gray-500">ä¸€å¼µéƒ½æ²’ä¸­... (T_T)<br>ä¸‹æ¬¡ä¸€å®šæœƒæ›´å¥½ï¼</td></tr>`;
                 }
            } else if (html === "") {
                 html = `<tr><td colspan='3' class="px-4 py-8 text-center text-gray-500">å…¨è»è¦†æ²’...</td></tr>`;
            }
            
            detailsBody.innerHTML = html;
        }

        // --- ç‰¹æ•ˆ: è³ºéŒ¢æ™‚å™´å½©å¸¶ ---
        function triggerConfetti() {
            var duration = 2 * 1000;
            var animationEnd = Date.now() + duration;
            var defaults = { startVelocity: 30, spread: 360, ticks: 60, zIndex: 0 };

            var random = function(min, max) {
            return Math.random() * (max - min) + min;
            }

            var interval = setInterval(function() {
            var timeLeft = animationEnd - Date.now();

            if (timeLeft <= 0) {
                return clearInterval(interval);
            }

            var particleCount = 50 * (timeLeft / duration);
            // since particles fall down, start a bit higher than random
            confetti(Object.assign({}, defaults, { particleCount, origin: { x: random(0.1, 0.3), y: Math.random() - 0.2 } }));
            confetti(Object.assign({}, defaults, { particleCount, origin: { x: random(0.7, 0.9), y: Math.random() - 0.2 } }));
            }, 250);
        }
    </script>
</body>
</html>